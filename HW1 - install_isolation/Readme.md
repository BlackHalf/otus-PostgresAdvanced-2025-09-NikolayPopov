
1. Создать новый проект в Яндекс облако или на любых ВМ, например postgres2024-<yyyymmdd>, где
yyyymmdd год, месяц и день вашего рождения (имя проекта должно быть уникально)
Будем использовать VM на гипервизоре Proxmox

2. Создать инстанс виртуальной машины с дефолтными параметрами - 1-2 ядра, 2-4Гб памяти, любой
линукс (на курсе Ubuntu 100%)

![Установка Ubuntu на Proxmox](image.png)

3. Добавить свой ssh ключ

Используем вход по паролю.

4. Зайти удаленным ssh (первая сессия)
![login](image-1.png)

5. Поставить PostgreSQL из пакетов apt install
![setup](image-2.png)

6. Зайти вторым ssh (вторая сессия)

![alt text](image-16.png)

7. Запустить везде psql из под пользователя postgres

![alt text](image-17.png)

8. Выключить auto commit

В PostgreSQL, в отличие от некоторых других СУБД, режим auto commit по умолчанию отключен. 
На сервере команда выдает ошибку после версии 9.5

```
postgres=# SET AUTOCOMMIT TO OFF;
ERROR:  unrecognized configuration parameter "autocommit"
```

На клиенте 
```
\set AUTOCOMMIT off
```

9. Сделать в первой сессии новую таблицу и наполнить ее данными

![create_table](image-3.png)

10. Посмотреть текущий уровень изоляции: show transaction isolation level

![alt text](image-4.png)

11. Начать новую транзакцию в обоих сессиях с дефолтным (не меняя) уровнем изоляции

![begin](image-5.png)

12. В первой сессии добавить новую запись

![insert](image-6.png)

13. Посмотреть таблицу во второй сессии. Видите ли вы новую запись и если да то почему?

![not_visible](image-7.png)

Мы не видим новую запись поскольку транзакция вставки не зафиксирована.

14. Завершить первую транзакцию

![commit](image-8.png)

15. Посмотреть таблицу во второй сессии. Видите ли вы новую запись и если да то почему?
Завершить транзакцию во второй сессии.

![visible](image-9.png)

Теперь запись видна поскольку транзакция вставки подтверждена и с этим уровнем изоляции транзакций она и должна быть видима.

16. Начать новые транзакции с repeatable read

![begin 2](image-10.png)

17. В первой сессии добавить новую запись

![insert 2](image-11.png)

18. Посмотреть таблицу во второй сессии. Видите ли вы новую запись и если да то почему?

![select 2](image-12.png)

Запись не видна, поскольку транзакция вставки не подтверждена.

19. Завершить первую транзакцию

![commit 2](image-13.png)

20. Посмотреть таблицу во второй сессии. Видите ли вы новую запись и если да то почему?

![select 3](image-14.png)

Запись не видна, поскольку с этим уровнем изоляции должна обеспечиваться повторяемость чтения внутри транзакции.

Завершить транзакцию во второй сессии. 

![commit 3](image-15.png)

После завершения транзакции запись стала видна.
Мы проверили уровни изоляции транзакций в PostgreSQL и изучили их отличия.